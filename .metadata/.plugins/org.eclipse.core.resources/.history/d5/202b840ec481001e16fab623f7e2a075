import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;

import javax.swing.ImageIcon;
import javax.swing.JLabel;



public class ClientRoom extends JLabel{
	
	BufferedReader in;
	private int roomIndex;
	
	private ImageIcon waitRoom = new ImageIcon("./LobbyImages/waitRoom.png"); //배경화면
	private boolean isCreated = false;
			
	public ClientRoom(ImageIcon roomImage, int idx, BufferedReader in, BufferedWriter out, String userName, String userId) {
		super(roomImage);
		this.roomIndex = idx;
		this.in = in;
		
		setSize(roomImage.getIconWidth(),roomImage.getIconHeight());
		setLocation(20+roomImage.getIconWidth()*(idx%2),40+roomImage.getIconHeight()*(idx/2));
		ServerReceiver receiver = new ServerReceiver();
		receiver.start();
		
		addMouseListener(new MouseAdapter(){ // 액션 이벤트 처리	
			@Override
			public void mouseClicked(MouseEvent e) {
				// 빈 방 클릭시
				if(!isCreated) {
					isCreated=true;
					try {
						out.write("3/"+userId+"/"+userName+"/"+idx+"\n");
						out.flush();
					} catch (IOException e1) {
						// TODO Auto-generated catch block
						e1.printStackTrace();
					}
				} 
				// 이미 만들어져있는 방 클릭시
				else {
					try {
						out.write("4/"+userId+"/"+userName+"/"+idx+"\n");
						out.flush();
					} catch (IOException e1) {
						// TODO Auto-generated catch block
						e1.printStackTrace();
					}
				}
	
			}
		});
	}
	
	
	// 서버로부터 메세지를 받아옴
	public class ServerReceiver extends Thread {
		@Override
		public void run() {
			String msg = null;
			while (true) {
				try {
					msg = in.readLine();
				} catch (Exception e) {
					break;
				}

				int msgType = Integer.parseInt(msg.split("/")[0]);
				String userId = msg.split("/")[1];
				String userName = msg.split("/")[2];
				String msgContent = msg.split("/")[3];
				
				System.out.println(msg);
				
				switch(msgType) {
				case 3: // 플레이어가 방 생성시
						setIcon(waitRoom);
						JLabel roomTitle = new JLabel(userName+" 님의 방");
						roomTitle.setSize(200,50);
						roomTitle.setLocation(0,30);
						add(roomTitle);
						repaint();
					break;
				default:
					break;
				}
			}

		}
	}
	
}
